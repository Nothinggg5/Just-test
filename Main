local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService") -- для сериализации JSON

local SaveFileName = "rjp_position.json" -- имя файла для сохранения позиции

-- Функция сохранения позиции в локальный файл
local function savePositionToFile(position)
    local data = HttpService:JSONEncode({x = position.X, y = position.Y, z = position.Z})
    writefile(SaveFileName, data) -- функция writefile должна быть доступна в вашем эксплойте
end

-- Функция загрузки позиции из файла
local function loadPositionFromFile()
    if not isfile(SaveFileName) then return nil end
    local data = readfile(SaveFileName)
    local decoded = HttpService:JSONDecode(data)
    if decoded and decoded.x and decoded.y and decoded.z then
        return Vector3.new(decoded.x, decoded.y, decoded.z)
    end
    return nil
end

local Plugin = {
    PluginName = "RejoinPos",
    PluginDescription = "Перезаход с сохранением позиции локально",
    Commands = {
        ["rjp"] = {
            ListName = "rjp",
            Description = "Сохранить позицию и телепортироваться на неё после перезахода",
            Function = function(args, speaker)
                if not speaker then return end
                if not speaker.Character then return end
                local hrp = speaker.Character:FindFirstChild("HumanoidRootPart")
                if not hrp then return end

                local pos = hrp.Position
                savePositionToFile(pos)
                speaker:LoadCharacter()

                -- Телепорт сразу после появления HumanoidRootPart
                coroutine.wrap(function()
                    local char = speaker.Character or speaker.CharacterAdded:Wait()
                    local hrpNew = char:WaitForChild("HumanoidRootPart", 10)
                    if hrpNew then
                        local savedPos = loadPositionFromFile()
                        if savedPos then
                            char:PivotTo(CFrame.new(savedPos))
                        end
                    end
                end)()
            end,
        },
    },
}

return Plugin
